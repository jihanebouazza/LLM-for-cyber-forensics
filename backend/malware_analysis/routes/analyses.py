from uuid import UUID
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session

from ..database import get_db
from ..models import MalwareAnalysis
from ..schemas.malware_analysis import MalwareAnalysisOut

router = APIRouter()


@router.get("/{sample_id}/analyses", response_model=list[MalwareAnalysisOut])
def read_analyses(sample_id: UUID, db: Session = Depends(get_db)):
    return (
        db.query(MalwareAnalysis)
        .filter(MalwareAnalysis.sample_id == sample_id)
        .order_by(MalwareAnalysis.created_at.desc())  # if you have created_at
        .all()
    )
