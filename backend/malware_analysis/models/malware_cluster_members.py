from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy import Column, ForeignKey
from ..database import Base
from sqlalchemy.orm import relationship


class MalwareClusterMember(Base):
    __tablename__ = "malware_cluster_members"

    # Composite primary key: (cluster_id, sample_id)
    cluster_id = Column(
        UUID(as_uuid=True),
        ForeignKey("malware_clusters.id"),
        primary_key=True,
        nullable=False,
    )

    sample_id = Column(
        UUID(as_uuid=True),
        ForeignKey("malware_samples.id"),
        primary_key=True,
        nullable=False,
    )

    cluster = relationship("MalwareCluster", back_populates="members")
    sample = relationship("MalwareSample", back_populates="cluster_memberships")