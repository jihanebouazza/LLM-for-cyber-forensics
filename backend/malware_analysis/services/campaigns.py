from sqlalchemy.orm import Session
from uuid import uuid4
from ..models import Campaign, MalwareSample


def create_campaign(db: Session, name: str, description: str | None = None) -> Campaign:
    obj = Campaign(id=uuid4(), name=name, description=description)
    db.add(obj)
    return obj


def list_campaigns(db: Session):
    return db.query(Campaign).all()


def get_campaign(db: Session, campaign_id):
    return db.query(Campaign).filter(Campaign.id == campaign_id).first()


def get_campaign_by_name(db: Session, name: str):
    return db.query(Campaign).filter(Campaign.name == name).first()


def set_sample_campaign(db: Session, sample_id, campaign_id):
    sample = db.query(MalwareSample).filter(
        MalwareSample.id == sample_id).first()
    if not sample:
        return None
    sample.campaign_id = campaign_id
    return sample


def list_samples_by_campaign(db: Session, campaign_id):
    return db.query(MalwareSample).filter(MalwareSample.campaign_id == campaign_id).all()
